<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="æå…¨æ°‘çš„ä¸ªäººåšå®¢"><title>Handler æºç åˆ†æ | èœ—ç‰›å£³</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-65882749-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Handler æºç åˆ†æ</h1><a id="logo" href="/.">èœ—ç‰›å£³</a><p class="description">è®¡ç®—æœºåªæœ‰ 0 å’Œ 1 ï¼Œä½†ä¸–ç•Œæ˜¯è¿ç»­çš„</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Handler æºç åˆ†æ</h1><div class="post-meta">Nov 23, 2015<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span></div><div class="post-content"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ã€ç¯å¢ƒã€‘æºç åˆ†æåŸºäº 4.4.2_r1ã€‚</p>
<h2 id="Handlerçš„ä½¿ç”¨"><a href="#Handlerçš„ä½¿ç”¨" class="headerlink" title="Handlerçš„ä½¿ç”¨"></a>Handlerçš„ä½¿ç”¨</h2><p>æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ç”¨åˆ°Handlerï¼ŒHandlerç”¨äºå‘ä¸€ä¸ªçº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯å¹¶è´Ÿè´£å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå®ç°å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€å°†è€—æ—¶ä»»åŠ¡æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œå¹¶åœ¨æ‰§è¡Œå®Œæ¯•åé€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–°UIç­‰åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå°ğŸŒ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºHandler</span></span><br><span class="line">Handler myHandler = <span class="keyword">new</span> Handler() &#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;   </span><br><span class="line">		<span class="keyword">switch</span> (msg.what) &#123;  </span><br><span class="line">		&#125;   </span><br><span class="line">		<span class="keyword">super</span>.handleMessage(msg);   </span><br><span class="line">	&#125;   </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡Handlerå‘é€æ¶ˆæ¯</span></span><br><span class="line">Message message = <span class="keyword">new</span> Message();      </span><br><span class="line">message.what = <span class="number">1</span>;      </span><br><span class="line">myHandler.sendMessage(message);</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Handlerçš„ç»å…¸è¿‡ç¨‹ï¼šå‘å‡ºçš„æ¶ˆæ¯ä¼šåœ¨æ—¶é—´åˆ°è¾¾çš„æ—¶å€™è¿›å…¥åˆ°Handlerçš„handleMessageä¸­è¢«å¤„ç†ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ¢ç©¶ä¸€ä¸‹Messageä»è¢«åˆ›å»ºåˆ°è¢«å¤„ç†åˆ°åº•ç»å†äº†ä»€ä¹ˆæ ·çš„è¿‡ç¨‹ã€‚<a id="more"></a></p>
<h2 id="æºç å‰–æ"><a href="#æºç å‰–æ" class="headerlink" title="æºç å‰–æ"></a>æºç å‰–æ</h2><p>å¦‚ğŸŒ°æ‰€ç¤ºï¼Œæˆ‘ä»¬ä»new Handler()åˆ‡å…¥ï¼Œç„¶åè¿½è¸ªsendMessageæ–¹æ³•ï¼ŒæŸ¥çœ‹Messageå¯¹è±¡å¦‚ä½•è¿›å…¥handleMessageæ–¹æ³•ï¼Œä¸€æ­¥æ­¥å‰–æï¼Œè§£ææ•´ä¸ªæµç¨‹ã€‚</p>
<h3 id="Handlerç‰‡æ®µâ€”â€”Handleråˆ›å»º"><a href="#Handlerç‰‡æ®µâ€”â€”Handleråˆ›å»º" class="headerlink" title="Handlerç‰‡æ®µâ€”â€”Handleråˆ›å»º"></a>Handlerç‰‡æ®µâ€”â€”Handleråˆ›å»º</h3><p>å…ˆçœ‹ä¸€ä¸‹Handlerçš„åˆ›å»ºè¿‡ç¨‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (FIND_POTENTIAL_LEAKS) &#123;</span><br><span class="line">		<span class="keyword">final</span> Class&lt;? extends Handler&gt; klass = getClass();</span><br><span class="line">		<span class="keyword">if</span> ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class="line">				(klass.getModifiers() &amp; Modifier.STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">			Log.w(TAG, <span class="string">"The following Handler class should be static or leaks might occur: "</span> + klass.getCanonicalName());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	mLooper = Looper.myLooper();</span><br><span class="line">	<span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Can't create handler inside thread that has not called Looper.prepare()"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	mQueue = mLooper.mQueue;<span class="comment">//è·å–æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">	mCallback = callback;</span><br><span class="line">	mAsynchronous = async;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé‡ç‚¹æ˜¯ <strong>mLooper = Looper.myLooper();</strong> ä»¥åŠåé¢ä¸‰è¡Œä»£ç ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œæ–°å»ºä¸€ä¸ªHandlerçš„æ—¶å€™ï¼Œå¦‚æœLooper.myLooperä¸ºnullï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›å¦‚æœä¸ä¸ºnullï¼Œåˆ™è·å–Looperä¸­çš„mQueueã€‚å…¶ä½™ä¸¤ä¸ªå‚æ•°ä¸æ˜¯é‡ç‚¹ï¼Œæš‚ä¸åˆ†æã€‚</p>
<h3 id="Looperç‰‡æ®µâ€”â€”Looperåˆ›å»º"><a href="#Looperç‰‡æ®µâ€”â€”Looperåˆ›å»º" class="headerlink" title="Looperç‰‡æ®µâ€”â€”Looperåˆ›å»º"></a>Looperç‰‡æ®µâ€”â€”Looperåˆ›å»º</h3><p>Androidä¸­æä¾›äº†ç›¸å…³æ­¥éª¤ï¼Œå¯ä»¥ä½¿å¾—ä¸€ä¸ªæ™®é€šThreadä¹Ÿå…·å¤‡æ¶ˆæ¯å¾ªç¯å¤„ç†æœºåˆ¶ï¼ˆå› ä¸ºä¸»çº¿ç¨‹é»˜è®¤åšäº†ä¸€äº›æ“ä½œï¼Œå› æ­¤ä¸å¥½åˆ†æï¼Œæˆ‘ä»¬ä»æ™®é€šçº¿ç¨‹å…¥æ‰‹ï¼Œå¯ä»¥æ›´æ¸…æ¥šçš„çœ‹åˆ°æ•´ä¸ªåˆ›å»ºè¿‡ç¨‹ï¼‰ã€‚ç¤ºä¾‹ä»£ç å¯ä»¥åœ¨Looperæºç (ç±»æ³¨é‡Š)ä¸­æ‰¾åˆ°:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LooperThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">     <span class="keyword">public</span> Handler mHandler;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          Looper.prepare();</span><br><span class="line"></span><br><span class="line">          mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">                 <span class="comment">// process incoming messages here</span></span><br><span class="line">              &#125;</span><br><span class="line">         &#125;;</span><br><span class="line">         Looper.loop();</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¶‰åŠåˆ°å¦å¤–ä¸€ä¸ªé‡è¦çš„å¯¹è±¡ï¼š<strong>Looper</strong>ã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ <strong>Looper.prepare();</strong> æ–¹æ³•ï¼Œæºç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Initialize the current thread as a looper.</span></span><br><span class="line"><span class="comment"> * This gives you a chance to create handlers that then reference</span></span><br><span class="line"><span class="comment"> * this looper, before actually starting the loop. Be sure to call</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #loop()&#125; after calling this method, and end it by calling</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #quit()&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	prepare(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹å¼‚å¸¸ï¼Œå¼‚å¸¸æ¶ˆæ¯çš„å«ä¹‰æ˜¯ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªLooperã€‚è€Œåˆ¤æ–­çš„æ¡ä»¶æ˜¯ï¼Œä»sThreadLocalä¸­è·å–çš„å¯¹è±¡ä¸ä¸ºnullâ€”â€”<a href="http://www.muzileecoding.com/java/Java-threadlocal.html" target="_blank" rel="noopener">ThreadLocal</a>æ§åˆ¶æ¯ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªLooperå®ä¾‹ã€‚<br>å¦‚æœä¹‹å‰æ²¡æœ‰åˆ›å»ºLooperï¼Œåˆ™ä¼šå®ä¾‹åŒ–ä¸€ä¸ªLooperï¼Œçœ‹ä¸€ä¸‹æ„é€ æ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯ç§æœ‰çš„</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Looper</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">	mQueue = <span class="keyword">new</span> MessageQueue(quitAllowed);</span><br><span class="line">	mThread = Thread.currentThread();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ å‡½æ•°åˆ†ä¸ºä¸¤æ­¥ï¼š1ï¼‰åˆ›å»ºäº†ä¸€ä¸ªMessageQueueï¼›2ï¼‰è·å–å½“å‰çš„çº¿ç¨‹ã€‚æ³¨æ„mQueueè¿™ä¸ªå˜é‡ï¼Œå°±æ˜¯ä¸Šä¸€èŠ‚ä¸­Handlerä»Looperä¸­è·å–çš„æ¶ˆæ¯é˜Ÿåˆ—å¯¹è±¡ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Handlerã€Looperå’ŒMessageQueueä¸‰ä¸ªå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„ç‚¹:</p>
<ol>
<li>new Handler()ä¹‹å‰ï¼Œå¿…é¡»ä¿è¯Looper.myLooper()æ–¹æ³•çš„è¿”å›ä¸ä¸ºnullï¼›</li>
<li>Looperåœ¨æ–°å»ºçš„æ—¶å€™ä¼šå»ºç«‹å¯¹åº”çš„MessageQueueï¼Œå¹¶ä¸”prepare()æ–¹æ³•ä¼šé€šè¿‡ThreadLocalä¿è¯æ¯ä¸€ä¸ªçº¿ç¨‹åªä¼šå®ä¾‹åŒ–ä¸€ä¸ªLooperã€‚</li>
<li>Handleræ—¢ä¼šæŒæœ‰Looperçš„å¼•ç”¨ï¼Œåˆä¼šæŒæœ‰MessageQueueçš„å¼•ç”¨ï¼›</li>
</ol>
<p>ä½†æ˜¯è¿™å‡ ä¸ªç±»ä¹‹é—´çš„å…³ç³»æˆ‘ä»¬å´ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä¸‹é¢è§£é‡Šã€‚</p>
<h3 id="çº¿ç¨‹ã€Handlerã€Looperçš„è”ç³»"><a href="#çº¿ç¨‹ã€Handlerã€Looperçš„è”ç³»" class="headerlink" title="çº¿ç¨‹ã€Handlerã€Looperçš„è”ç³»"></a>çº¿ç¨‹ã€Handlerã€Looperçš„è”ç³»</h3><p>åœ¨æ¶ˆæ¯æœºåˆ¶é‡Œé¢ï¼ŒLooperåªæ˜¯è´Ÿè´£ç®¡ç†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯å–å‡ºæ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œè€ŒHandleråˆ™æ˜¯è´Ÿè´£å‘é€æ¶ˆæ¯ä»¥åŠå¤„ç†æ¶ˆæ¯çš„ï¼Œé‚£ä¹ˆHandlerå’ŒLooperåˆæ˜¯å¦‚ä½•ç»‘å®šåˆ°ä¸€èµ·çš„å‘¢ï¼Ÿä»Handlerçš„æºç çœ‹ï¼Œå…³é”®ä»£ç æ˜¯:  <strong>mLooper = Looper.myLooper();</strong> ï¼Œæºç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * null if the calling thread is not associated with a Looper.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Looper <span class="title">myLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> sThreadLocal.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡ŒæŠŠæ³¨é‡Šä¹ŸCopyè¿‡æ¥äº†ï¼ŒmyLooperæ–¹æ³•æ˜¯ç›´æ¥ä»sThreadLocalä¸­è¯»å–çš„å˜é‡ï¼Œæ³¨é‡Šè¯´åˆ°ï¼šmyLooper()æ–¹æ³•åœ¨å½“å‰æ²¡æœ‰Looperç»‘å®šåˆ°è°ƒç”¨çº¿ç¨‹æ—¶ä¼šè¿”å›nullã€‚æœç´¢æ•´ä¸ªLooperç±»ï¼Œä¼šå‘ç°åªæœ‰å‰é¢æåˆ°çš„prepare()æ–¹æ³•ä¸­æœ‰sThreadLocal.set()è°ƒç”¨ã€‚å³åœ¨ä¸ºä¸€ä¸ªçº¿ç¨‹å®ä¾‹åŒ–Handlerä¹‹å‰ï¼Œå¿…é¡»åœ¨è¯¥çº¿ç¨‹ä¸­è°ƒç”¨Looper.prepare()æ–¹æ³•ï¼šåªæœ‰è¿™æ ·ï¼Œæ‰èƒ½ä¸ºä¸€ä¸ªçº¿ç¨‹å»ºç«‹å¯¹åº”çš„Looperâ€”â€”è¿™è§£é‡Šäº†å‰é¢LooperThreadä»£ç çš„æ„å»ºé€»è¾‘ã€‚</p>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡è°ƒç”¨Looper.prepare()æ–¹æ³•ä¸€æ¬¡ï¼Œå°±å¯ä»¥å°†ä¸€ä¸ªLooperå¯¹è±¡ç»‘å®šåˆ°æ–¹æ³•è°ƒç”¨çº¿ç¨‹ä¸Šå»(å³è®¾ç½®åˆ°ThreadLocalä¸­)ã€‚æ–°å»ºHandlerçš„æ—¶å€™ï¼ŒHandlerä¼šç›´æ¥è°ƒç”¨Looper.myLoop()æ–¹æ³•è·å–ç»‘å®šåˆ°çº¿ç¨‹çš„Looperå¹¶é€šè¿‡è¿™ä¸ªLooperè·å–åˆ°å¯¹åº”çš„MessageQueueã€‚</p>
<p>è¿™å°±æ˜¯è¿™å‡ ä¸ªæ¦‚å¿µä¹‹é—´çš„å…³ç³»ã€‚</p>
<h3 id="Looperç‰‡æ®µâ€”â€”Looper-loop"><a href="#Looperç‰‡æ®µâ€”â€”Looper-loop" class="headerlink" title="Looperç‰‡æ®µâ€”â€”Looper.loop()"></a>Looperç‰‡æ®µâ€”â€”Looper.loop()</h3><p>LooperThreadæ„å»ºçš„æœ€åä¸€æ­¥å°±æ˜¯è°ƒç”¨Loop.loop()æ–¹æ³•ï¼Œå®ƒçš„æºç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Run the message queue in this thread. Be sure to call</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #quit()&#125; to end the loop.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">final</span> Looper me = myLooper();</span><br><span class="line">	<span class="keyword">if</span> (me == <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">final</span> MessageQueue queue = me.mQueue;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Make sure the identity of this thread is that of the local process,</span></span><br><span class="line">	<span class="comment">// and keep track of what that identity token actually is.</span></span><br><span class="line">	Binder.clearCallingIdentity();</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">long</span> ident = Binder.clearCallingIdentity();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		Message msg = queue.next(); <span class="comment">// might block</span></span><br><span class="line">		<span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// This must be in a local variable, in case a UI event sets the logger</span></span><br><span class="line">		Printer logging = me.mLogging;</span><br><span class="line">			<span class="keyword">if</span> (logging != <span class="keyword">null</span>) &#123;</span><br><span class="line">  				logging.println(<span class="string">"&gt;&gt;&gt;&gt;&gt; Dispatching to "</span> + msg.target + <span class="string">" "</span> +</span><br><span class="line">                        msg.callback + <span class="string">": "</span> + msg.what);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			msg.target.dispatchMessage(msg);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (logging != <span class="keyword">null</span>) &#123;</span><br><span class="line">				logging.println(<span class="string">"&lt;&lt;&lt;&lt;&lt; Finished to "</span> + msg.target + <span class="string">" "</span> + msg.callback);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Make sure that during the course of dispatching the</span></span><br><span class="line">			<span class="comment">// identity of the thread wasn't corrupted.</span></span><br><span class="line">			<span class="keyword">final</span> <span class="keyword">long</span> newIdent = Binder.clearCallingIdentity();</span><br><span class="line">			<span class="keyword">if</span> (ident != newIdent) &#123;</span><br><span class="line">				Log.wtf(TAG, <span class="string">"Thread identity changed from 0x"</span></span><br><span class="line">                        + Long.toHexString(ident) + <span class="string">" to 0x"</span></span><br><span class="line">                        + Long.toHexString(newIdent) + <span class="string">" while dispatching to "</span></span><br><span class="line">                        + msg.target.getClass().getName() + <span class="string">" "</span></span><br><span class="line">                        + msg.callback + <span class="string">" what="</span> + msg.what);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			msg.recycle();<span class="comment">//å›æ”¶æ¶ˆæ¯ï¼Œæ³¨æ„è¿™ä¸ªä½ç½®</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼ŒåŒæ ·è¦æ±‚myLooperä¸èƒ½ä¸ºnullï¼ˆæ ¹æ®å‰é¢çš„åˆ†æï¼Œå®ç°è°ƒç”¨Looper.prepareï¼ˆ)æ–¹æ³•å³å¯ï¼‰å¹¶ä»è¿™ä¸ªLooperä¸­æ‹¿åˆ°ç›¸åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä¹‹åæˆ‘ä»¬è¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œè¿™ä¸ªå¾ªç¯ä¸­æœ€é‡è¦çš„äº‹æƒ…å°±æ˜¯queue.next()æ–¹æ³•çš„è°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•æ ¹æ®æ³¨é‡Šï¼šå¯èƒ½ä¼šå¼•èµ·é˜»å¡ã€‚ç›¸å…³çš„å®ç°å¯ä»¥æ·±å…¥åˆ°MessageQueueä¸­ï¼Œè¿™é‡Œæ¶‰åŠåˆ°Nativeä»£ç ï¼Œå…·ä½“çš„ç†è§£ä¸å½±å“åˆ°åŸç†è®²è¿°ï¼Œæš‚ä¸”ä¸è¡¨ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åˆ¤æ–­ï¼šå¦‚æœMessageæ‹¿å‡ºæ¥ä¸ºç©ºï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªMessageQueueå·²ç»è¢«ä¸¢å¼ƒäº†ï¼Œæ•´ä¸ªå¾ªç¯ä¼šè¢«æ‰“ç ´è¿”å›ï¼Œè¯»è€…å¯ä»¥æ³¨æ„ä¸€ä¸‹ã€‚</p>
<p>å†ä¹‹åå°±è¿›å…¥åˆ°msg.target.dispatchMessageæ–¹æ³•ã€‚å³æ¶ˆæ¯çš„åˆ†å‘å’Œå¤„ç†ã€‚</p>
<h3 id="å…³ç³»æ€»ç»“"><a href="#å…³ç³»æ€»ç»“" class="headerlink" title="å…³ç³»æ€»ç»“"></a>å…³ç³»æ€»ç»“</h3><p>è¿™é‡Œæ€»ç»“ä¸€ä¸‹: </p>
<ol>
<li>æˆ‘ä»¬åœ¨è®©ä¸€ä¸ªçº¿ç¨‹å…·å¤‡æ¶ˆæ¯å¾ªç¯è°ƒåº¦èƒ½åŠ›çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨Looper.prepare()ï¼Œè¿™ä¸ªæ–¹æ³•å¾ˆé‡è¦ï¼Œå®ƒä¼šä¸ºä¸€ä¸ªçº¿ç¨‹ç»‘å®šä¸€ä¸ªLooperï¼Œä¸”åªèƒ½ç»‘å®šä¸€ä¸ªã€‚åˆ›å»ºLooperçš„åŒæ—¶ï¼ŒLooperä¼šåˆ›å»ºä¸€ä¸ªMessageQueueã€‚ä¹‹ååœ¨çº¿ç¨‹ä¸­åˆ›å»ºHandlerçš„æ—¶å€™ï¼Œä¼šä»Looperä¸­å¼•ç”¨MessageQueueæ”¾åˆ°Handlerå®ä¾‹ä¸­å»ã€‚è‡³æ­¤Handlerã€Looperã€MessageQueueä¸‰ä¸ªç±»çš„å…³ç³»å»ºç«‹ã€‚</li>
<li>å…³ç³»å»ºç«‹ä¹‹åï¼Œè°ƒç”¨Looper.loop()æ–¹æ³•ä¼šè®©Loopè¿è¡Œèµ·æ¥ï¼šä¸æ–­ä»MessageQueueä¸­è·å–handleré€šè¿‡sendMessageå‘é€çš„Messageå¹¶dispatchMessageã€‚è‡³æ­¤ï¼Œæ•´ä¸ªæ¶ˆæ¯å¾ªç¯çš„æ ¸å¿ƒéƒ¨åˆ†æ„å»ºå®Œæ¯•ã€‚</li>
</ol>
<h3 id="æ¶ˆæ¯çš„åˆ†å‘å’Œå¤„ç†"><a href="#æ¶ˆæ¯çš„åˆ†å‘å’Œå¤„ç†" class="headerlink" title="æ¶ˆæ¯çš„åˆ†å‘å’Œå¤„ç†"></a>æ¶ˆæ¯çš„åˆ†å‘å’Œå¤„ç†</h3><p>æ•´ä¸ªæ¶ˆæ¯å¾ªç¯æ ¸å¿ƒéƒ¨åˆ†å·²ç»è¿è¡Œèµ·æ¥ï¼Œå‰©ä¸‹æ¥çš„å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸æœ€é•¿ä½¿ç”¨åˆ°çš„æ¶ˆæ¯çš„å‘é€å’Œå¤„ç†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ¶ˆæ¯ä»å‘é€åˆ°å¤„ç†ä¹‹é—´çš„æµç¨‹ã€‚é¦–å…ˆæ˜¯sendMessageæ–¹æ³•æºç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Enqueue a message into the message queue after all pending messages</span></span><br><span class="line"><span class="comment"> * before the absolute time (in milliseconds) &lt;var&gt;uptimeMillis&lt;/var&gt;.</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;The time-base is &#123;<span class="doctag">@link</span> android.os.SystemClock#uptimeMillis&#125;.&lt;/b&gt;</span></span><br><span class="line"><span class="comment"> * You will receive it in &#123;<span class="doctag">@link</span> #handleMessage&#125;, in the thread attached</span></span><br><span class="line"><span class="comment"> * to this handler.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uptimeMillis The absolute time at which the message should be</span></span><br><span class="line"><span class="comment"> *         delivered, using the</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@link</span> android.os.SystemClock#uptimeMillis&#125; time-base.</span></span><br><span class="line"><span class="comment"> *         </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Returns true if the message was successfully placed in to the </span></span><br><span class="line"><span class="comment"> *         message queue.  Returns false on failure, usually because the</span></span><br><span class="line"><span class="comment"> *         looper processing the message queue is exiting.  Note that a</span></span><br><span class="line"><span class="comment"> *         result of true does not mean the message will be processed -- if</span></span><br><span class="line"><span class="comment"> *         the looper is quit before the delivery time of the message</span></span><br><span class="line"><span class="comment"> *         occurs then the message will be dropped.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">	MessageQueue queue = mQueue;</span><br><span class="line">		<span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</span><br><span class="line">			RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                    <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</span><br><span class="line">			Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹æºç å°±ä¼šå‘ç°ï¼ŒåŒå&amp;åŠŸèƒ½ç›¸ä¼¼çš„æœ‰å¥½å‡ ä¸ªæ–¹æ³•ï¼Œä½†æœ€ç»ˆéƒ½ä¼šè°ƒç”¨sendMessageAtTimeæ–¹æ³•ï¼Œé¦–å…ˆè·å–mQueueï¼šæ³¨æ„è¿™ä¸ªæ–¹æ³•åœ¨Handleræ–°å»ºçš„æ—¶å€™å°±è·å–äº†ã€‚ä¹‹åè°ƒç”¨äº†ä¸€ä¸ªenqueueMessageæ–¹æ³•ï¼Œæºç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(MessageQueue queue, Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">	msg.target = <span class="keyword">this</span>;</span><br><span class="line">	<span class="keyword">if</span> (mAsynchronous) &#123;</span><br><span class="line">		msg.setAsynchronous(<span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œå°†msg.targetèµ‹å€¼ä¸ºæœ¬èº«ï¼Œä¹‹åæ ¹æ®Handleræ–°å»ºæ—¶å€™ä¼ å…¥çš„å‚æ•°(å‰é¢å¿½ç•¥äº†å®ƒ)è®¾ç½®msgå±æ€§ï¼Œä¹‹åå°±è°ƒqueueçš„enqueueMessageå‘é˜Ÿåˆ—ä¸­å‹å…¥æ¶ˆæ¯â€”â€”<strong>å®Œæˆæ¶ˆæ¯çš„å‘é€</strong>ã€‚</p>
<p>è¿™é‡Œå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯<strong>msg.target = this;</strong>ã€‚æŸ¥çœ‹Messageçš„æºç å°±å¯ä»¥çœ‹åˆ°ï¼Œtargetæ˜¯ä¸€ä¸ªHandlerå˜é‡ã€‚è€Œåœ¨å‰é¢è®²è¿°çš„Looper.loop()æ–¹æ³•å®ç°ä¸­ï¼Œå–å‡ºæ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•æ˜¯msg.target.dispatchMessage(msg);ã€‚å˜¿ï¼è¿™éš¾é“ä¸æ˜¯è°ƒç”¨çš„Handlerçš„dispatchMessageæ–¹æ³•ä¹ˆï¼Ÿçœ‹æºç æœç„¶å‘ç°ä¸€æš:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">		handleCallback(msg);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		handleMessage(msg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šæˆ‘ä»¬å¹³æ—¶ä¸å¸¸ç”¨çš„æ–¹æ³•:</p>
<p>ã€ 1 ã€‘Messageæ˜¯å¯ä»¥è‡ªå¸¦ä¸€ä¸ªcallbackå˜é‡çš„ï¼ŒæŸ¥çœ‹Meesgaeæºç å¯çŸ¥è¿™æ˜¯ä¸€ä¸ªRunnableå˜é‡ï¼Œå³æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªMessageå®ç°postä¸€ä¸ªRunableå¯¹è±¡çš„åŠŸèƒ½ï¼Œå› ä¸ºhandleCallbackçš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handleCallback</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">	message.callback.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šè¯»è€…å¯ä»¥æŸ¥çœ‹Handler.postDelayed(Runnable)æ–¹æ³•ï¼Œå†…éƒ¨æ­£å¼åšäº†è¿™ä¸€å±‚è½¬æ¢ã€‚</p>
<p>ã€ 2 ã€‘å¦‚æœå®ä¾‹åŒ–Handlerçš„æ—¶å€™è®¾ç½®äº†mCallbackå¯¹è±¡ï¼ˆæ—¥å¸¸å¼€å‘å¾ˆå°‘ç”¨ï¼Œä½†çš„ç¡®å­˜åœ¨è¿™ç§ç”¨æ³•ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å°å¼Ÿéƒ½å…ˆäº¤ç»™mCallbackå¤„ç†ï¼ŒmCallbackæ˜¯ä¸€ä¸ªCallBackå¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å£:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callback</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™è¾¹å¯ä»¥é€šè¿‡è¿”å›trueæ¥æ‹¦æˆªhandleMessageçš„æ‰§è¡Œã€‚</p>
<p>ã€ 3 ã€‘ä»¥ä¸Šéƒ½ç»•è¿‡äº†ï¼Œæ‰è½®åˆ°handleMessageæ–¹æ³•æ‰§è¡Œâ€”â€”å…³äºè¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œå†™Handlerçš„æ—¶å€™è‚¯å®šä¼šé‡è½½å®ƒã€‚</p>
<p>åˆ°æ­¤ï¼Œæ¶ˆæ¯çš„å¤„ç†åˆ†æå®Œæ¯•ã€‚</p>
<h2 id="å‰–ææ€»ç»“"><a href="#å‰–ææ€»ç»“" class="headerlink" title="å‰–ææ€»ç»“"></a>å‰–ææ€»ç»“</h2><p>åˆ°è¿™é‡Œï¼Œå¯¹äºæ•´ä¸ªæ¶ˆæ¯å¤„ç†å‘é€ã€å¾ªç¯ã€å‘é€çš„æœºåˆ¶åŸºæœ¬è§£é‡Šæ¸…æ¥šã€‚å‰©ä¸‹ä¸€å—æ¯”è¾ƒæ¨¡ç³Šï¼šMessageQueueçš„åˆ†ææ¯”è¾ƒå°‘ï¼ŒåŸå› æ˜¯è¿™å—æ¶‰åŠåˆ°ä¸€äº›Nativeä»£ç ï¼Œä¸”å¯¹ç†è§£æ•´ä¸ªHandleræœºåˆ¶çš„ç†è§£å½±å“ä¸å¤§ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­æš‚ä¸åˆ†æã€‚</p>
<p>æˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“ä¸€ä¸‹å‡ ä¸ªæ¦‚å¿µä¹‹é—´çš„å…³ç³»:</p>
<p><img src="http://7xktd8.com1.z0.glb.clouddn.com/HandleråŸç†å›¾.png" alt="Handleræ¶ˆæ¯æµè½¬å›¾"></p>
<p>è¯¥å›¾é‡ç‚¹å±•ç¤ºäº†å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>Handlerç›´æ¥å‘MessageQueueä¸­å‘é€æ¶ˆæ¯ï¼›</li>
<li>Looperè´Ÿè´£è·å–æ¶ˆæ¯å¹¶ä½œåˆ†å‘ï¼ˆä½†æ˜¯å…·ä½“åˆ†å‘åˆ°å“ªä¸ªHandleræ˜¯ç”±Messageçš„targetå±æ€§å†³å®šçš„ï¼‰ï¼›</li>
<li><strong>ä¸€ä¸ªçº¿ç¨‹åªä¼šæœ‰ä¸€ä¸ªLooperå’Œä¸€ä¸ªMessageQueueï¼Œä¸è®ºè¯¥çº¿ç¨‹æœ‰å¤šå°‘ä¸ªHandlerï¼Œå®ƒä»¬éƒ½å…¬ç”¨è¿™ä¸ªLooperå’ŒMessageQueueï¼›</strong></li>
</ol>
<p>HandlerThreadæ˜¯ä¸²è¡ŒåŒ–æ‰§è¡Œä»»åŠ¡ï¼Œå› æ­¤åœ¨é‡Œé¢æ‰§è¡Œä»»åŠ¡æ˜¯çº¿ç¨‹å®‰å…¨çš„(æŒ‡çš„æ˜¯ä»»åŠ¡ä¹‹é—´ï¼Œè€Œä¸æ˜¯å’Œå…¶ä½™çº¿ç¨‹ä¹‹é—´)ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¹Ÿéœ€è¦æ³¨æ„å°†è€—æ—¶ä»»åŠ¡å’Œéè€—æ—¶ä»»åŠ¡åŒºåˆ†åœ¨ä¸åŒçš„é˜Ÿåˆ—é‡Œé¢ï¼Œæé«˜æ•ˆç‡ã€‚è¿™ä¸ªç±»è¿˜å¾ˆé€‚åˆæ‰§è¡Œé“¾å¼ä»»åŠ¡ï¼Œæ¯”å¦‚ç¼–è¯‘ä»»åŠ¡ã€‚</p>
<h2 id="ä¸€äº›é—®é¢˜"><a href="#ä¸€äº›é—®é¢˜" class="headerlink" title="ä¸€äº›é—®é¢˜"></a>ä¸€äº›é—®é¢˜</h2><h3 id="ä¸»çº¿ç¨‹å’Œä¸»Handler"><a href="#ä¸»çº¿ç¨‹å’Œä¸»Handler" class="headerlink" title="ä¸»çº¿ç¨‹å’Œä¸»Handler"></a>ä¸»çº¿ç¨‹å’Œä¸»Handler</h3><p>åœ¨æ‰€æœ‰çš„çº¿ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹æ˜¯éå¸¸ç‰¹æ®Šçš„ï¼Œå¼€å‘æ—¶åœ¨ä¸»çº¿ç¨‹ä¸­æ–°å»ºHandlerçš„å®ä¾‹ä¸éœ€è¦èµ°ä¸Šé¢çš„æµç¨‹ï¼Œç›´æ¥åˆ›å»ºå³å¯ï¼Œå®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼Œä¸»çº¿ç¨‹æœ¬èº«å°±å·²ç»å¯åŠ¨Looperäº†ã€‚å…¶å®åœ¨Looperä¸­ï¼Œæ˜¯æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•åšè¿™ä»¶äº‹çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Initialize the current thread as a looper, marking it as an</span></span><br><span class="line"><span class="comment"> * application's main looper. The main looper for your application</span></span><br><span class="line"><span class="comment"> * is created by the Android environment, so you should never need</span></span><br><span class="line"><span class="comment"> * to call this function yourself.  See also: &#123;<span class="doctag">@link</span> #prepare()&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepareMainLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	prepare(<span class="keyword">false</span>);</span><br><span class="line">	<span class="keyword">synchronized</span> (Looper.class) &#123;</span><br><span class="line">		<span class="keyword">if</span> (sMainLooper != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The main Looper has already been prepared."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		sMainLooper = myLooper();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„çœ‹æ³¨é‡Šï¼ï¼ï¼è¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ›å»ºä¸»çº¿ç¨‹çš„Looperçš„ã€‚æ³¨é‡Šä¸­è¯´ï¼Œè¿™ä¸ªåˆ›å»ºæ˜¯ç”±Android Environmentæ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¼€å‘è€…<strong>ä»æ¥ä¸éœ€è¦</strong>æ‰‹åŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è€Œä¸‹é¢è¿™ä¸ªæ–¹æ³•åˆ™æ˜¯ç”¨äºè·å–ä¸»Looperçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * Returns the application's main looper, which lives in the main thread of the application.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Looper <span class="title">getMainLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">synchronized</span> (Looper.class) &#123;</span><br><span class="line">		<span class="keyword">return</span> sMainLooper;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¶ˆæ¯çš„recycle"><a href="#æ¶ˆæ¯çš„recycle" class="headerlink" title="æ¶ˆæ¯çš„recycle"></a>æ¶ˆæ¯çš„recycle</h3><p>Messageå†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€æœ‰è¢«å›æ”¶çš„Messageéƒ½æŒ‚åœ¨è¿™ä¸ªé“¾è¡¨ä¸Šã€‚å…³é”®çš„æ–¹æ³•å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object sPoolSync = <span class="keyword">new</span> Object();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Message sPool;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> sPoolSize = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_POOL_SIZE = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return a new Message instance from the global pool. Allows us to</span></span><br><span class="line"><span class="comment"> * avoid allocating new objects in many cases.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title">obtain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">		<span class="keyword">if</span> (sPool != <span class="keyword">null</span>) &#123;</span><br><span class="line">			Message m = sPool;</span><br><span class="line">			sPool = m.next;</span><br><span class="line">			m.next = <span class="keyword">null</span>;</span><br><span class="line">			m.flags = <span class="number">0</span>; <span class="comment">// clear in-use flag</span></span><br><span class="line">			sPoolSize--;</span><br><span class="line">			<span class="keyword">return</span> m;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Message();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recycle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (isInUse()) &#123;</span><br><span class="line">		<span class="keyword">if</span> (gCheckRecycle) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"This message cannot be recycled because it "</span></span><br><span class="line">                        + <span class="string">"is still in use."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	recycleUnchecked();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recycleUnchecked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Mark the message as in use while it remains in the recycled object pool.</span></span><br><span class="line">	<span class="comment">// Clear out all other details.</span></span><br><span class="line">	flags = FLAG_IN_USE;</span><br><span class="line">	what = <span class="number">0</span>;</span><br><span class="line">	arg1 = <span class="number">0</span>;</span><br><span class="line">	arg2 = <span class="number">0</span>;</span><br><span class="line">	obj = <span class="keyword">null</span>;</span><br><span class="line">	replyTo = <span class="keyword">null</span>;</span><br><span class="line">	sendingUid = -<span class="number">1</span>;</span><br><span class="line">	when = <span class="number">0</span>;</span><br><span class="line">	target = <span class="keyword">null</span>;</span><br><span class="line">	callback = <span class="keyword">null</span>;</span><br><span class="line">	data = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">		<span class="keyword">if</span> (sPoolSize &lt; MAX_POOL_SIZE) &#123;</span><br><span class="line">			next = sPool;</span><br><span class="line">			sPool = <span class="keyword">this</span>;</span><br><span class="line">			sPoolSize++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateCheckRecycle</span><span class="params">(<span class="keyword">int</span> targetSdkVersion)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">		gCheckRecycle = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯æœºåˆ¶ä¸‹é¢å…¶å®ç»´æŠ¤ç€ä¸€ä¸ªæ¶ˆæ¯é“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨å……å½“ç€å¯¹è±¡æ± çš„è§’è‰²ï¼Œå› æ­¤å»ºè®®å¤§å®¶ä½¿ç”¨obtain()æ¥â€œåˆ›å»ºâ€æ¶ˆæ¯ï¼Œè¿™æ ·å¯ä»¥é¿å…åˆ›å»ºå¤§é‡çš„Messageå¯¹è±¡ã€‚è¡¥å……ä¸€ç‚¹ï¼šæ¶ˆæ¯ä¼šåœ¨è¢«å‹å…¥é˜Ÿåˆ—æ—¶ç½®ä¸ºFLAG_IN_USEã€‚  </p>
<blockquote>
<p>ã€æ³¨æ„ã€‘åœ¨5.0ä»¥ä¸‹çš„æ—¶å€™ï¼ŒgCheckRecycleå¼€å…³æ˜¯å…³é—­çš„ï¼Œè¿™æ„å‘³ç€å›æ”¶æ—¶ä¸ä¼šå»æ£€æŸ¥Messageæ˜¯å¦åœ¨ä½¿ç”¨ä¸­ã€‚è€Œåœ¨5.0ä»¥ä¸Šå°±ä¼šæ£€æŸ¥ï¼Œæ­¤å¤„å¾ˆå‘çˆ¹çš„æ˜¯ï¼šFLAG_IN_USEæ ‡å¿—ä½çš„é‡ç½®æ˜¯åœ¨obtainçš„æ—¶å€™æ¸…é™¤é‡ç½®çš„ï¼Œåœ¨è¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—åˆ™ä¼šè¢«ç½®ä½ã€‚ä»å‰é¢Looper.loop()æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªæ¶ˆæ¯ä¼šåœ¨dispatchMessageä¹‹åç«‹åˆ»è°ƒç”¨recycleæ–¹æ³•ï¼Œæ­¤æ—¶æ¶ˆæ¯çš„FLAG_IN_USEè¿˜æ²¡æœ‰è¢«é‡ç½®ï¼Œrecycleå¿…ç„¶å¯¼è‡´å¼‚å¸¸æŠ›å‡ºâ€”â€”è¿™åº”è¯¥æ˜¯SDKçš„ä¸€ä¸ªBugã€‚</p>
</blockquote>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><ol>
<li>ä»¥ä¸‹æ–¹æ³•è¢«ä»MessageQueueæš´éœ²åˆ°Handleré‡Œé¢:<code>hasMeesgae()</code>ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰å¥½å‡ ä¸ªé‡è½½æ–¹æ³•ï¼Œå¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œç”¨äºåˆ¤æ–­é˜Ÿåˆ—ä¸­æœ‰æ²¡æœ‰ç‰¹å®šçš„æ¶ˆæ¯;</li>
<li>Handlerè¿˜æœ‰ä¸€ä¸ªè¿™æ ·çš„æ–¹æ³•: <code>Handler.postAtFrontOfQueue()</code>ï¼Œå¯ä»¥è®©æ¶ˆæ¯æ’é˜Ÿ;</li>
</ol>
</div><div class="tags"><a href="/tags/æºç /">æºç </a></div><div class="post-nav"><a href="/2015/12/02/Android-AsyncTask/" class="pre">AsyncTask æºç åˆ†æ</a><a href="/2015/11/21/Java-ConcurrentHashMap/" class="next">Java ConcurrentHashMapè¡¥å……</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">59</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactiveX/">ReactiveX</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/åç«¯/">åç«¯</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/å·¥å…·/">å·¥å…·</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/å½±è§†/">å½±è§†</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/æŠ€æœ¯/">æŠ€æœ¯</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ç”µå½±/">ç”µå½±</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/Gitbook/" style="font-size: 15px;">Gitbook</a> <a href="/tags/Runtime/" style="font-size: 15px;">Runtime</a> <a href="/tags/è§†å›¾/" style="font-size: 15px;">è§†å›¾</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/æƒé™/" style="font-size: 15px;">æƒé™</a> <a href="/tags/ä»£ç ä¼˜åŒ–/" style="font-size: 15px;">ä»£ç ä¼˜åŒ–</a> <a href="/tags/Framework/" style="font-size: 15px;">Framework</a> <a href="/tags/æ€§èƒ½ä¼˜åŒ–/" style="font-size: 15px;">æ€§èƒ½ä¼˜åŒ–</a> <a href="/tags/å·¥å…·/" style="font-size: 15px;">å·¥å…·</a> <a href="/tags/åˆé›†/" style="font-size: 15px;">åˆé›†</a> <a href="/tags/ADB/" style="font-size: 15px;">ADB</a> <a href="/tags/æºç /" style="font-size: 15px;">æºç </a> <a href="/tags/åç¼–è¯‘/" style="font-size: 15px;">åç¼–è¯‘</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/åŸºç¡€/" style="font-size: 15px;">åŸºç¡€</a> <a href="/tags/æ•ˆç‡/" style="font-size: 15px;">æ•ˆç‡</a> <a href="/tags/MarkDown/" style="font-size: 15px;">MarkDown</a> <a href="/tags/ç”µå½±/" style="font-size: 15px;">ç”µå½±</a> <a href="/tags/Reactive/" style="font-size: 15px;">Reactive</a> <a href="/tags/AIDL/" style="font-size: 15px;">AIDL</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/é©±åŠ¨/" style="font-size: 15px;">é©±åŠ¨</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/æ—¥å¿—/" style="font-size: 15px;">æ—¥å¿—</a> <a href="/tags/äº‹ä»¶/" style="font-size: 15px;">äº‹ä»¶</a> <a href="/tags/ä»£ç è®¾è®¡/" style="font-size: 15px;">ä»£ç è®¾è®¡</a> <a href="/tags/ç½‘ç»œ/" style="font-size: 15px;">ç½‘ç»œ</a> <a href="/tags/æµ‹è¯•/" style="font-size: 15px;">æµ‹è¯•</a> <a href="/tags/Binder/" style="font-size: 15px;">Binder</a> <a href="/tags/Groovy/" style="font-size: 15px;">Groovy</a> <a href="/tags/Loader/" style="font-size: 15px;">Loader</a> <a href="/tags/RAC/" style="font-size: 15px;">RAC</a> <a href="/tags/äº‹ä»¶å¤„ç†/" style="font-size: 15px;">äº‹ä»¶å¤„ç†</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/AIDL-åŸç†åˆ†æ/">AIDL åŸç†åˆ†æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/App-å¯åŠ¨è¿‡ç¨‹/">App å¯åŠ¨è¿‡ç¨‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/PMS-è§£æ/">PMS è§£æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/WMS-è§£æ/">WindowManagerService è§£æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/AMS-è§£æ/">AMS è§£æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/The-Good-Wife/">The-Good-Wife</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/Black-Sails/">é»‘å¸†</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/29/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/23/XCode-8-2-1-ClangFormat-æ’ä»¶å®‰è£…/">XCode 8.2.1 ClangFormat æ’ä»¶å®‰è£…</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/07/SourceTree-åˆ†æ”¯å›¾è°±/">SourceTree åˆ†æ”¯å›¾è°±</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2018 <a href="/." rel="nofollow">èœ—ç‰›å£³.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>