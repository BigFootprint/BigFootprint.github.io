<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="æå…¨æ°‘çš„ä¸ªäººåšå®¢"><title>Androidçš„æ•°æ®æ¢å¤(äºŒ) | èœ—ç‰›å£³</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-65882749-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Androidçš„æ•°æ®æ¢å¤(äºŒ)</h1><a id="logo" href="/.">èœ—ç‰›å£³</a><p class="description">è®¡ç®—æœºåªæœ‰ 0 å’Œ 1 ï¼Œä½†ä¸–ç•Œæ˜¯è¿ç»­çš„</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Androidçš„æ•°æ®æ¢å¤(äºŒ)</h1><div class="post-meta">Oct 17, 2015<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span></div><div class="post-content"><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨Androidä¸Šï¼Œä¼šæœ‰ä»¥ä¸‹åŸå› å¯¼è‡´éœ€è¦ä¿å­˜å’Œæ¢å¤å½“å‰é¡µé¢çš„æ•°æ®ï¼š  </p>
<ol>
<li>ä¸€ä¸ªActivityé€€åˆ°åå°ï¼šæ¯”å¦‚è·³è½¬åˆ°å¦å¤–ä¸€ä¸ªActivityï¼Œæˆ–è€…æŒ‰Homeé”®é€€åˆ°åç«¯;</li>
<li>ç³»ç»Ÿé…ç½®å˜åŒ–ï¼Œå¦‚ï¼šå±å¹•æ—‹è½¬(åœ¨ç”¨æˆ·æ„è¯†é‡Œåªæ˜¯å±å¹•æ—‹è½¬ï¼Œå®é™…ä¸ŠActivityæ˜¯è¢«æ€æ‰åé‡å»º);</li>
</ol>
<p>ç¬¬ä¸€ç§æƒ…å†µåªæœ‰åœ¨å†…å­˜ä¸è¶³ï¼Œåå°Activityç¡®å®è¢«ç³»ç»Ÿå›æ”¶æ‰çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ•°æ®æ¢å¤ï¼Œå¦‚æœActivityæ­£å¸¸å­˜åœ¨äºå†…å­˜ä¸­ï¼Œåˆ™ä¸éœ€è¦æ•°æ®æ¢å¤ï¼Œä½†ä¸€å®šä¼šåšæ•°æ®ä¿å­˜ã€‚ç¬¬äºŒç§æƒ…å†µæ˜¯å› ä¸ºåœ¨ç”¨æˆ·çœ¼é‡Œåªæ˜¯ç•Œé¢æ—‹è½¬äº†ä¸€ä¸‹ï¼Œè€Œå®é™…ä¸ŠActivityæ˜¯è¢«é”€æ¯é‡å»ºçš„ï¼Œè¿™ä¸ªæ—¶å€™åšæ•°æ®æ¢å¤æ˜¯åˆç†è€Œä¸”åº”å½“çš„ã€‚<a id="more"></a></p>
<h2 id="æ•°æ®å¦‚ä½•ä¿å­˜"><a href="#æ•°æ®å¦‚ä½•ä¿å­˜" class="headerlink" title="æ•°æ®å¦‚ä½•ä¿å­˜"></a>æ•°æ®å¦‚ä½•ä¿å­˜</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‰ä¸ªæ–¹æ³•è¿›è¡ŒActivityçš„æ•°æ®æ¢å¤ä¸ä¿å­˜ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState)</span>  </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span>  </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span><span class="params">(Bundle savedInstanceState)</span></span></span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬é€šè¿‡ç¬¬ä¸€ä¸ªæ–¹æ³•çš„outStateå‚æ•°ä¿å­˜æ•°æ®ï¼Œåé¢ä¸¤ä¸ªæ–¹æ³•çš„savedInstanceStateå‚æ•°è·å–ä¿å­˜çš„æ•°æ®ã€‚onRestoreInstanceStateæ–¹æ³•åœ¨onStartåé¢onResumeå‰é¢æ‰§è¡Œã€‚</p>
<p>å…³äºä»¥ä¸Šä¸¤ç‚¹ï¼Œå¼€å‘è€…å®˜ç½‘ä¸Šéƒ½æœ‰æ¯”è¾ƒå®Œå–„çš„æè¿°ï¼Œè¯»è€…å¯ä»¥ä»”ç»†é˜…è¯»ï¼š<a href="http://developer.android.com/training/basics/activity-lifecycle/recreating.html" target="_blank" rel="noopener">ã€åŸæ–‡é“¾æ¥ã€‘</a></p>
<p>è¿™ä¸€éƒ¨åˆ†ç¨æœ‰ç»éªŒçš„å¼€å‘è€…éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œæœ¬æ–‡é‡ç‚¹è®²è¿°çš„æ˜¯<strong>Viewå¦‚ä½•å»ä¿å­˜æ¢å¤æ•°æ®</strong>ã€‚</p>
<h2 id="ViewçŠ¶æ€å¦‚ä½•ä¿å­˜"><a href="#ViewçŠ¶æ€å¦‚ä½•ä¿å­˜" class="headerlink" title="ViewçŠ¶æ€å¦‚ä½•ä¿å­˜"></a>ViewçŠ¶æ€å¦‚ä½•ä¿å­˜</h2><p>ä¸€ä¸ªActivityå±•ç¤ºç»™ç”¨æˆ·çš„é™¤äº†æ•°æ®ï¼Œå°±æ˜¯Viewï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åšæ¢å¤çš„æ—¶å€™ï¼Œä¸ä»…éœ€è¦æ¢å¤é‡è¦æ•°æ®ï¼Œä¹Ÿéœ€è¦å°½å¯èƒ½çš„æ¢å¤Viewçš„çŠ¶æ€ã€‚</p>
<p>æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬ä¸€èˆ¬æ˜¯é€šè¿‡onSaveInstanceStateå»ä¿å­˜Viewçš„çŠ¶æ€(æ¯”å¦‚EditTexçš„è¾“å…¥å†…å®¹)ï¼Œæ¢å¤çš„æ—¶å€™å°†æ•°æ®è¯»å‡ºè®¾ç½®åˆ°Viewä¸­å»ï¼Œä½†è¿™ç§æ–¹å¼ç²—æš´æœ‰ç”¨ä½†ä¸ä¼˜é›…ï¼Œä¸¾ä¸ªğŸŒ°ï¼šæˆ‘å°è£…äº†ä¸€ä¸ªCustomViewï¼Œå…¶ä¸­åŒ…å«ç€ä¸€ä¸ªEditTextï¼Œå¦‚æœæŒ‰ç…§å‰é¢çš„æ–¹å¼å»åšæ¢å¤åˆ™EditTextä¸€å®šè¦æš´éœ²ç»™å¤–éƒ¨ï¼Œå¦åˆ™Activityå°±ä¸èƒ½è·å–å¹¶è®¾ç½®å€¼ï¼Œè¿™ç ´åäº†ç»„ä»¶çš„å°è£…æ€§ã€‚</p>
<p>å…¶å®Androidå†…éƒ¨æ˜¯æœ‰ä¸€å¥—ViewçŠ¶æ€ä¿å­˜å’Œæ¢å¤æœºåˆ¶çš„ï¼Œä¸éœ€è¦é€šè¿‡Activityçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»å®ç°ã€‚é˜…è¯»å®˜æ–¹æ–‡æ¡£çš„è¯»è€…å¯ä»¥æ³¨æ„ä¸€ç‚¹ï¼Œæ–‡ä¸­æåˆ°äº†EditTextçŠ¶æ€çš„ä¿å­˜æ¡ä»¶ï¼šéœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„idã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çœ‹ä¸€ä¸‹Viewçš„æ•°æ®ä¿å­˜æœºåˆ¶ï¼Œä»ä¸­æ‰¾å‡ºå›ç­”å‰é¢é—®é¢˜çš„ç­”æ¡ˆã€‚</p>
<blockquote>
<p>ã€Noteã€‘å»ºè®®æ‰“å¼€Android Studioï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¯”è¾ƒå¤šï¼Œç›´æ¥é˜…è¯»æºç å¯¹ç…§é˜…è¯»æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚</p>
</blockquote>
<h3 id="Activityçš„onSaveInstanceState-æ–¹æ³•"><a href="#Activityçš„onSaveInstanceState-æ–¹æ³•" class="headerlink" title="Activityçš„onSaveInstanceState()æ–¹æ³•"></a>Activityçš„onSaveInstanceState()æ–¹æ³•</h3><p>Viewè¯´åˆ°åº•æ˜¯å±äºActivityçš„ï¼ŒonSaveInstanceStateæ˜¯æ•´ä¸ªActivityä¿å­˜æ•°æ®çš„å‡ºå‘ç‚¹ï¼Œæˆ‘ä»¬ä»è¿™é‡Œå…¥æ‰‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState)</span> </span>&#123;</span><br><span class="line">	outState.putBundle(WINDOW_HIERARCHY_TAG, mWindow.saveHierarchyState());</span><br><span class="line">	Parcelable p = mFragments.saveAllState();</span><br><span class="line">	<span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">		outState.putParcelable(FRAGMENTS_TAG, p);</span><br><span class="line">	&#125;</span><br><span class="line">	getApplication().dispatchActivitySaveInstanceState(<span class="keyword">this</span>, outState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚ä»£ç æ‰€ç¤ºï¼Œç¬¬äºŒè¡Œå°†æ•´ä¸ªWindowçš„çŠ¶æ€ä¿å­˜åœ¨ä¸€ä¸ªBundleä¸­ï¼Œå°†å€¼ä¿å­˜åˆ°ontStateä¸­å»ï¼Œçœ‹ä¸Šå»å¾ˆæœ‰å¯èƒ½ä¸Viewç›¸å…³ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°ã€‚</p>
<p>3-6è¡Œåˆ™æ˜¯è§¦å‘Fragmentæ•°æ®ä¿å­˜çš„ï¼ˆä¸‹ä¸€ç¯‡åšæ–‡ä¸»é¢˜ï¼‰ã€‚å…³äºWindnowçš„è§£é‡Šï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡åšå®¢ï¼š<a href="http://www.cnblogs.com/lqminn/archive/2013/05/01/3050776.html" target="_blank" rel="noopener">ã€Androidã€‘Androidç•Œé¢ä»é‡Œè‡³å¤–æµ…æï¼ˆä¸€ï¼‰</a></p>
<h3 id="Windowçš„saveHierarchyState-æ–¹æ³•"><a href="#Windowçš„saveHierarchyState-æ–¹æ³•" class="headerlink" title="Windowçš„saveHierarchyState()æ–¹æ³•"></a>Windowçš„saveHierarchyState()æ–¹æ³•</h3><p>äº†è§£ä¹‹åï¼Œæˆ‘ä»¬å®šä½åˆ°PhoneWindowä¸­çš„saveHierarchyStateæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Bundle <span class="title">saveHierarchyState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Bundle outState = <span class="keyword">new</span> Bundle();</span><br><span class="line">	<span class="keyword">if</span> (mContentParent == <span class="keyword">null</span>) &#123;</span><br><span class="line"> 		<span class="keyword">return</span> outState;</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	SparseArray&lt;Parcelable&gt; states = <span class="keyword">new</span> SparseArray&lt;Parcelable&gt;();</span><br><span class="line"> 	mContentParent.saveHierarchyState(states);</span><br><span class="line"> 	outState.putSparseParcelableArray(VIEWS_TAG, states);</span><br><span class="line"> 	....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ­¤å¤„çœç•¥äº†éƒ¨åˆ†ä»£ç ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•è§¦å‘äº†mContentParentçš„saveHierarchyStateçš„æ–¹æ³•ã€‚mContentParentåˆæ˜¯ä½•æ–¹ç¥åœ£ï¼ŸæŸ¥çœ‹å…¶å£°æ˜å‘ç°ï¼šå®ƒæ˜¯ä¸€ä¸ªViewGroupã€‚æ¯”å¯¹<a href="http://www.cnblogs.com/lqminn/archive/2013/05/01/3050776.html" target="_blank" rel="noopener">ã€Androidã€‘Androidç•Œé¢ä»é‡Œè‡³å¤–æµ…æï¼ˆä¸€ï¼‰</a>ä¸­çš„å›¾ï¼Œè¿™ä¸ªmContentParentåˆåœ¨ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿè¯»è€…å¯ä»¥é˜…è¯»ä¸€ä¸‹PhoneWindowé‡Œé¢çš„setContentViewæ–¹æ³•ï¼Œå…¶å®è¿™ä¸ªmContentParentå°±æ˜¯å›¾ä¸­DecorViewä¸‹çš„LinearLayoutï¼Œå³æˆ‘ä»¬setContentViewçš„çˆ¶å®¹å™¨ã€‚</p>
<p>ç„¶åæˆ‘ä»¬çœ‹åˆ°æ–¹æ³•å£°æ˜äº†ä¸€ä¸ªSparseArrayå¯¹è±¡ï¼Œå­˜å‚¨çš„æ˜¯Parcelableï¼Œè¿™ä¸ªSparseArrayå¯¹è±¡è¢«ä¼ é€’ç»™äº†ViewGroupçš„saveHierarchyStateæ–¹æ³•ï¼Œä¹‹åè¿™ä¸ªSparseArrayå¯¹è±¡åˆè¢«å­˜å‚¨åˆ°äº†outBundleä¸­å»äº†ï¼Œé‚£ä¹ˆé—®é¢˜å°±åœ¨äºsaveHierarchyStateè¿™ä¸ªæ–¹æ³•åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</p>
<h3 id="ViewGroupçš„saveHierarchyState-æ–¹æ³•"><a href="#ViewGroupçš„saveHierarchyState-æ–¹æ³•" class="headerlink" title="ViewGroupçš„saveHierarchyState()æ–¹æ³•"></a>ViewGroupçš„saveHierarchyState()æ–¹æ³•</h3><p>æ ‡é¢˜è™½ç„¶æ˜¯ViewGroupçš„saveHierarchyState()æ–¹æ³•ï¼Œä½†ViewGroupæœ¬èº«å…¶å®å¹¶æ²¡æœ‰saveHierarchyStateæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç»§æ‰¿äºå®ƒçš„çˆ¶ç±»â€”â€”Viewã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveHierarchyState</span><span class="params">(SparseArray&lt;Parcelable&gt; container)</span> </span>&#123;</span><br><span class="line">	dispatchSaveInstanceState(container);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchSaveInstanceState</span><span class="params">(SparseArray&lt;Parcelable&gt; container)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mID != NO_ID &amp;&amp; (mViewFlags &amp; SAVE_DISABLED_MASK) == <span class="number">0</span>) &#123;</span><br><span class="line">		mPrivateFlags &amp;= ~PFLAG_SAVE_STATE_CALLED;</span><br><span class="line">		Parcelable state = onSaveInstanceState();</span><br><span class="line">		<span class="keyword">if</span> ((mPrivateFlags &amp; PFLAG_SAVE_STATE_CALLED) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Derived class did not call super.onSaveInstanceState()"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (state != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// Log.i("View", "Freezing #" + Integer.toHexString(mID)</span></span><br><span class="line">			<span class="comment">// + ": " + state);</span></span><br><span class="line">			container.put(mID, state);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå®ƒè°ƒç”¨äº†dispatchSaveInstanceStateæ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åˆ™è°ƒç”¨æœ¬èº«çš„onSaveInstanceStateæ–¹æ³•è·å–ä¸€ä¸ªParcelableå¯¹è±¡ï¼Œé€šè¿‡Viewçš„idå°†è¿™ä¸ªå¯¹è±¡å­˜å‚¨åˆ°SparseArrayé‡Œé¢å»äº†ã€‚è€ŒViewGroupé‡Œé¢é‡å†™äº†dispatchSaveInstanceStateæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchSaveInstanceState</span><span class="params">(SparseArray&lt;Parcelable&gt; container)</span></span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.dispatchSaveInstanceState(container);</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">int</span> count = mChildrenCount;</span><br><span class="line">	<span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">		View c = children[i];</span><br><span class="line">		<span class="keyword">if</span> ((c.mViewFlags &amp; PARENT_SAVE_DISABLED_MASK) != PARENT_SAVE_DISABLED) &#123;</span><br><span class="line">			c.dispatchSaveInstanceState(container);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç å¾ˆå¥½ç†è§£ï¼šå®ƒä¸ä½†ä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œè¿˜éå†æ‰€æœ‰çš„å­Viewï¼Œè°ƒç”¨ä»–ä»¬çš„dispatchSaveInstanceStateæ–¹æ³•å»ä¿å­˜æ•°æ®ã€‚</p>
<h3 id="Viewæ•°æ®ä¿å­˜æ€»ç»“"><a href="#Viewæ•°æ®ä¿å­˜æ€»ç»“" class="headerlink" title="Viewæ•°æ®ä¿å­˜æ€»ç»“"></a>Viewæ•°æ®ä¿å­˜æ€»ç»“</h3><p>ç»¼ä¸Šï¼ŒViewæœ¬èº«çš„æ•°æ®ä¿å­˜æœºåˆ¶æ˜¯è¿™æ ·çš„: <strong>Activityä¼šè§¦å‘æ ¹ViewGroupå°†è¯¥å‘½ä»¤ä¼ è¾¾ç»™æ‰€æœ‰çš„å­Viewï¼ŒåŒæ—¶ä¼ é€’ä¸€ä¸ªSparseArrayç»™å®ƒä»¬ã€‚Viewè°ƒç”¨è‡ªå·±çš„onSaveInstanceState()å°†è‡ªå·±çš„çŠ¶æ€ä»¥<id, state="">æ–¹å¼å­˜å‚¨åˆ°SparseArrayä¸­å»ï¼Œæœ€ç»ˆSparseArrayä¼šè¢«ä¿å­˜åˆ°outStateä¸­ã€‚</id,></strong></p>
<p>ç°åœ¨è§£ç­”å‰é¢è¯´åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šidå”¯ä¸€çš„å¿…è¦æ€§ã€‚å¹³æ—¶ç¼–ç ä¸­idä»…ç”¨äºå®šä½Viewï¼Œæ‰€ä»¥å¦‚æœèƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå³ä½¿Idé‡å¤ä¹Ÿæ²¡æœ‰å…³ç³»ã€‚ä½†æ˜¯åœ¨ä¿å­˜çŠ¶æ€çš„æ—¶å€™ï¼Œå› ä¸ºKeyå°±æ˜¯idï¼Œå¦‚æœidé‡å¤ï¼Œé‚£ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿä¿å­˜çš„æ—¶å€™æ•°æ®ä¼šè¢«è¦†ç›–ï¼Œæ¢å¤çš„æ—¶å€™ç›¸åŒidçš„Viewä¼šè¢«ä»¥åŒæ ·çš„æ•°æ®æ¢å¤ï¼Œå¾ˆå¤šäººéƒ½é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼ŒåŸå› å°±åœ¨äºæ­¤ã€‚</p>
<h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>è¿™é‡Œé€šè¿‡ä»¥TextViewä¸ºğŸŒ°çœ‹ä¸€ä¸‹å®é™…çš„æƒ…å†µ:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Parcelable <span class="title">onSaveInstanceState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Parcelable superState = <span class="keyword">super</span>.onSaveInstanceState();</span><br><span class="line">	<span class="comment">// Save state if we are forced to</span></span><br><span class="line">	<span class="keyword">boolean</span> save = mFreezesText;</span><br><span class="line">	<span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> end = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (mText != <span class="keyword">null</span>) &#123;</span><br><span class="line">		start = getSelectionStart();</span><br><span class="line">		end = getSelectionEnd();</span><br><span class="line">		<span class="keyword">if</span> (start &gt;= <span class="number">0</span> || end &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">// Or save state if there is a selection</span></span><br><span class="line">			save = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (save) &#123;</span><br><span class="line">		SavedState ss = <span class="keyword">new</span> SavedState(superState);</span><br><span class="line">		<span class="comment">// XXX Should also save the current scroll position!</span></span><br><span class="line">		ss.selStart = start;</span><br><span class="line">		ss.selEnd = end;</span><br><span class="line">		<span class="keyword">if</span> (mText <span class="keyword">instanceof</span> Spanned) &#123;</span><br><span class="line">			Spannable sp = <span class="keyword">new</span> SpannableStringBuilder(mText);</span><br><span class="line">			<span class="keyword">if</span> (mEditor != <span class="keyword">null</span>) &#123;</span><br><span class="line">				removeMisspelledSpans(sp);</span><br><span class="line">				sp.removeSpan(mEditor.mSuggestionRangeSpan);</span><br><span class="line">			&#125;</span><br><span class="line">			ss.text = sp;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ss.text = mText.toString();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (isFocused() &amp;&amp; start &gt;= <span class="number">0</span> &amp;&amp; end &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			ss.frozenWithFocus = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		ss.error = getError();</span><br><span class="line">		<span class="keyword">return</span> ss;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> superState;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä»£ç æ‰€ç¤ºï¼ŒTextViewå°±é€šè¿‡è¿™ä¸ªæ–¹æ³•ä¿å­˜äº†å®ƒæ˜¾ç¤ºçš„textï¼Œä¸è¿‡å¼€å‘è€…å¯ä»¥é€šè¿‡è®¾ç½®mFreezesTextæ§åˆ¶å¦è¦ä¿å­˜ã€‚è¯»è€…æœ‰å…´è¶£è¿˜å¯ä»¥å»çœ‹çœ‹ScrollViewè¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚</p>
<p>##æ€»ç»“<br><strong>æ•°æ®æ¢å¤çš„è¿‡ç¨‹å’Œæ•°æ®ä¿å­˜çš„æµç¨‹ç±»ä¼¼ï¼Œæ­¤å¤„ç•¥å»ä¸è¡¨ã€‚</strong></p>
<p>ä»å¼€å‘ç»éªŒæ¥çœ‹ï¼ŒAndroidä¸Šå›æ”¶èµ„æºå‘ç”Ÿçš„æ¯”è¾ƒé¢‘ç¹ï¼Œåšå¥½çŠ¶æ€ä¿å­˜æ¢å¤å·¥ä½œå¯¹äºæå‡ç”¨æˆ·ä½“éªŒæœ‰å¾ˆå¤§å¸®åŠ©ã€‚æ–‡ç« ä¸»è¦é˜è¿°äº†ViewçŠ¶æ€ä¿å­˜æ¢å¤çš„è¿‡ç¨‹ï¼Œæœ‰åŠ©äºå¼€å‘è€…æ›´å¥½çš„åˆ©ç”¨è¯¥æœºåˆ¶: </p>
<ol>
<li>æ³¨æ„idé—®é¢˜â€”â€”ç²—æš´çš„æ–¹å¼é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯å¦‚æœç²—æš´å·²ç»å¼•èµ·äº†è®¾è®¡æˆ–è€…å®ç°é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘Viewçš„å†…å»ºæœºåˆ¶ï¼Œå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œidçš„é‡å¤ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªè€ƒè™‘æ–¹å‘;</li>
<li>å¦‚æœæƒ³å†™ä¸€ä¸ªCustomViewå¹¶ä¸”æƒ³ä¿å­˜çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡é‡è½½onSaveInstanceState()æ–¹æ³•å®ç°ï¼Œæ¢å¤ä¹Ÿæœ‰å“åº”çš„æ–¹å¼ï¼Œç®€å•ä¼˜é›…ä¸”ä¸ä¾èµ–äºä½¿ç”¨è€…;</li>
</ol>
</div><div class="tags"><a href="/tags/æºç /">æºç </a></div><div class="post-nav"><a href="/2015/10/17/Movie/" class="pre">é‚£äº›å¹´è®¡åˆ’çœ‹çš„ç”µå½±</a><a href="/2015/10/17/Volley-za-tan/" class="next">Volleyæ‚è°ˆ</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">59</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactiveX/">ReactiveX</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/åç«¯/">åç«¯</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/å·¥å…·/">å·¥å…·</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/å½±è§†/">å½±è§†</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/æŠ€æœ¯/">æŠ€æœ¯</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ç”µå½±/">ç”µå½±</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/Gitbook/" style="font-size: 15px;">Gitbook</a> <a href="/tags/Runtime/" style="font-size: 15px;">Runtime</a> <a href="/tags/è§†å›¾/" style="font-size: 15px;">è§†å›¾</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/æƒé™/" style="font-size: 15px;">æƒé™</a> <a href="/tags/ä»£ç ä¼˜åŒ–/" style="font-size: 15px;">ä»£ç ä¼˜åŒ–</a> <a href="/tags/Framework/" style="font-size: 15px;">Framework</a> <a href="/tags/æ€§èƒ½ä¼˜åŒ–/" style="font-size: 15px;">æ€§èƒ½ä¼˜åŒ–</a> <a href="/tags/å·¥å…·/" style="font-size: 15px;">å·¥å…·</a> <a href="/tags/åˆé›†/" style="font-size: 15px;">åˆé›†</a> <a href="/tags/ADB/" style="font-size: 15px;">ADB</a> <a href="/tags/æºç /" style="font-size: 15px;">æºç </a> <a href="/tags/åç¼–è¯‘/" style="font-size: 15px;">åç¼–è¯‘</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/åŸºç¡€/" style="font-size: 15px;">åŸºç¡€</a> <a href="/tags/æ•ˆç‡/" style="font-size: 15px;">æ•ˆç‡</a> <a href="/tags/MarkDown/" style="font-size: 15px;">MarkDown</a> <a href="/tags/ç”µå½±/" style="font-size: 15px;">ç”µå½±</a> <a href="/tags/Reactive/" style="font-size: 15px;">Reactive</a> <a href="/tags/AIDL/" style="font-size: 15px;">AIDL</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/é©±åŠ¨/" style="font-size: 15px;">é©±åŠ¨</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/æ—¥å¿—/" style="font-size: 15px;">æ—¥å¿—</a> <a href="/tags/äº‹ä»¶/" style="font-size: 15px;">äº‹ä»¶</a> <a href="/tags/ä»£ç è®¾è®¡/" style="font-size: 15px;">ä»£ç è®¾è®¡</a> <a href="/tags/ç½‘ç»œ/" style="font-size: 15px;">ç½‘ç»œ</a> <a href="/tags/æµ‹è¯•/" style="font-size: 15px;">æµ‹è¯•</a> <a href="/tags/Binder/" style="font-size: 15px;">Binder</a> <a href="/tags/Groovy/" style="font-size: 15px;">Groovy</a> <a href="/tags/Loader/" style="font-size: 15px;">Loader</a> <a href="/tags/RAC/" style="font-size: 15px;">RAC</a> <a href="/tags/äº‹ä»¶å¤„ç†/" style="font-size: 15px;">äº‹ä»¶å¤„ç†</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/AIDL-åŸç†åˆ†æ/">AIDL åŸç†åˆ†æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/App-å¯åŠ¨è¿‡ç¨‹/">App å¯åŠ¨è¿‡ç¨‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/PMS-è§£æ/">PMS è§£æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/WMS-è§£æ/">WindowManagerService è§£æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/AMS-è§£æ/">AMS è§£æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/The-Good-Wife/">The-Good-Wife</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/Black-Sails/">é»‘å¸†</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/29/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/23/XCode-8-2-1-ClangFormat-æ’ä»¶å®‰è£…/">XCode 8.2.1 ClangFormat æ’ä»¶å®‰è£…</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/07/SourceTree-åˆ†æ”¯å›¾è°±/">SourceTree åˆ†æ”¯å›¾è°±</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2018 <a href="/." rel="nofollow">èœ—ç‰›å£³.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>