<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="李全民的个人博客"><title>Hexo 高级玩法和坑 | 蜗牛壳</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-65882749-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Hexo 高级玩法和坑</h1><a id="logo" href="/.">蜗牛壳</a><p class="description">计算机只有 0 和 1 ，但世界是连续的</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Hexo 高级玩法和坑</h1><div class="post-meta">Dec 3, 2016<span> | </span><span class="category"><a href="/categories/工具/">工具</a></span></div><div class="post-content"><p>Hexo 虽然已经有很多的主题实现了各种酷炫的功能和排版，但是依然有人不满足。本文就结合自己部署博客时所做改动介绍两个大家玩的比较溜的高级玩法，以及这两个玩法要注意的问题。</p>
<blockquote>
<p><a href="https://hexo.io/plugins/" target="_blank" rel="noopener">Hexo 插件官网</a>上有很多插件可以选择。Hexo的插件安装非常简单，在博客的根目录下面执行:<code>npm install -g 插件名</code>即可。</p>
</blockquote>
<h2 id="置顶功能"><a href="#置顶功能" class="headerlink" title="置顶功能"></a>置顶功能</h2><p>置顶功能相关的帖子最早出处应该是<a href="http://www.netcan666.com/2015/11/22/%E8%A7%A3%E5%86%B3Hexo%E7%BD%AE%E9%A1%B6%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">解决Hexo置顶问题</a>这篇文章。Hexo 在安装的时候就自带了生成 Index 的插件，也就是<code>/node_modules/hexo-generator-index</code>插件，这个插件的具体玩法在<a href="https://github.com/hexojs/hexo-generator-index" target="_blank" rel="noopener">这里</a>。可以有两个配置项，其中一个就表示根据 date 排序，也就是文章的创建日期。<a id="more"></a></p>
<p><a href="http://www.netcan666.com/2015/11/22/%E8%A7%A3%E5%86%B3Hexo%E7%BD%AE%E9%A1%B6%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">解决Hexo置顶问题</a>通过比较 top 来实现置顶问题，非常完美，但是要注意的是原来的排序代码是：</p>
<p><code>var posts = locals.posts.sort(config.index_generator.order_by);</code> </p>
<p>而新的代码却是：</p>
<p><code>posts.data = posts.data.sort(function(a, b)...</code></p>
<p>这里多了一个 data 属性，而不是直接对 posts 数组排序，如果不写这个，会出现乱序。</p>
<blockquote>
<p>所有文章也同样需要排序，它的修改位置在<code>/node_modules/hexo-generator-archive/lib/generator.js</code>中，搜索 sort 进行相同替换就可以了。</p>
</blockquote>
<p>另外这个 top 属性也可以拿来做别的事情，比如我们不仅希望博客可以指定，而且有明显的标识，像下面：</p>
<div align="center"><img src="http://7xktd8.com1.z0.glb.clouddn.com/博客置顶样式.png" alt="博客置顶样式" width="320"></div>

<p>在标题前面加上红色加粗”[置顶]”文案，那可以去修改对应主题<code>/layout/_partial/post/titls.ejs</code>文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (post.link)&#123; %&gt;</span><br><span class="line">  &lt;h1 itemprop=<span class="string">"name"</span>&gt;</span><br><span class="line">    &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"&lt;%= class_name %&gt;"</span> href=<span class="string">"&lt;%- url_for(post.link) %&gt;"</span> target=<span class="string">"_blank"</span> itemprop=<span class="string">"url"</span>&gt;</span><br><span class="line">      &lt;%<span class="keyword">if</span>(post.top)&#123;%&gt;&lt;span style="font-weight:bold;color:red"&gt;[置顶]&lt;/span&gt;&lt;% &#125; %&gt;&lt;%= post.title %&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">  &lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">&lt;% &#125; else if (post.title)&#123; %&gt;</span></span><br><span class="line"><span class="regexp">  &lt;% if (index)&#123; %&gt;</span></span><br><span class="line"><span class="regexp">    &lt;h1 itemprop="name"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;a class="&lt;%= class_name %&gt;" href="&lt;%- url_for(post.path) %&gt;"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;% if(post.top)&#123; %&gt;</span></span><br><span class="line"><span class="regexp">          &lt;% if(class_name !== 'archive-article-title')&#123; %&gt;</span></span><br><span class="line"><span class="regexp">            &lt;span style="font-weight:bold;color:red"&gt;[置顶]&lt;/</span>span&gt;</span><br><span class="line">          &lt;% &#125; <span class="keyword">else</span> &#123; %&gt;</span><br><span class="line">            &lt;span style=<span class="string">"font-weight:bold;color:red;display:inline"</span>&gt;[置顶]&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">          &lt;% &#125; %&gt;</span></span><br><span class="line"><span class="regexp">        &lt;% &#125; %&gt;</span></span><br><span class="line"><span class="regexp">        &lt;%= post.title %&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>a&gt;</span><br><span class="line">    &lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  &lt;% &#125; else &#123; %&gt;</span></span><br><span class="line"><span class="regexp">    &lt;h1 class="&lt;%= class_name %&gt;" itemprop="name"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;%if(post.top)&#123;%&gt;&lt;span style="font-weight:bold;color:red"&gt;[置顶]&lt;/</span>span&gt;&lt;% &#125; %&gt;&lt;%= post.title %&gt;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
<p>在所有显示标题的地方判断文章是不是top的，如果是，则添加文案。</p>
<h2 id="浏览量统计功能"><a href="#浏览量统计功能" class="headerlink" title="浏览量统计功能"></a>浏览量统计功能</h2><p>这个功能对于博客写作者来说应该是蛮重要一个功能，我的视线方案使用的是<a href="https://link.zhihu.com/?target=http%3A//crescentmoon.info/2014/12/11/popular-widget/" target="_blank" rel="noopener">使用LeanCloud平台为Hexo博客添加文章浏览量统计组件</a>所介绍的基于 LeadCloud 的方案。详细方案原文已经阐述，但这个方案实际是作者根据自己的需求进行开发的，也就是显示在边栏上。因此建议读者看懂 JS 代码之后再修改一下，下面是我的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span>(!index)&#123; %&gt;</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"post-meta"</span>&gt;总字数: &lt;%= wordcount(post.content) %&gt; | 阅读预计 &lt;%= min2read(post.content) %&gt; 分钟&lt;/span&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    	addCount();</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;% &#125; %&gt;</span></span><br></pre></td></tr></table></figure>
<p>我这里还涉及一个字数统计的功能，后面再介绍。然后修改<code>head.ejs</code>文件，在最后 header 标签之前添加：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"https://cdn1.lncld.net/static/js/av-min-1.5.0.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> APP_ID = <span class="string">'XXXXXXXX'</span>;</span><br><span class="line">    <span class="keyword">var</span> APP_KEY = <span class="string">'XXXXXXXXXXX'</span>;</span><br><span class="line">    AV.init(&#123;</span><br><span class="line">        appId: APP_ID,</span><br><span class="line">        appKey: APP_KEY</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;!--page counter part--&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    function addCount() &#123;</span></span><br><span class="line"><span class="regexp">        var Counter=AV.Object.extend("Counter");</span></span><br><span class="line"><span class="regexp">        url=$('.article-date').attr('href').trim();</span></span><br><span class="line"><span class="regexp">        title = $('.article-title').text().trim();</span></span><br><span class="line"><span class="regexp">        var query=new AV.Query(Counter);</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/use url as unique idnetfication</span></span><br><span class="line"><span class="regexp">        query.equalTo("url",url);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        query.find(&#123;</span></span><br><span class="line"><span class="regexp">            success: function(results)&#123;</span></span><br><span class="line"><span class="regexp">                if(results.length&gt;0) &#123;</span></span><br><span class="line"><span class="regexp">                    var counter=results[0];</span></span><br><span class="line"><span class="regexp">                    var times=counter.get('time')+1;</span></span><br><span class="line"><span class="regexp">                    $('.post-meta').append(" | PV: " + times);</span></span><br><span class="line"><span class="regexp">                    counter.set('time', times);</span></span><br><span class="line"><span class="regexp">                    counter.save();</span></span><br><span class="line"><span class="regexp">                &#125; else &#123;</span></span><br><span class="line"><span class="regexp">                    var newcounter=new Counter();</span></span><br><span class="line"><span class="regexp">                    newcounter.set("title",title);</span></span><br><span class="line"><span class="regexp">                    newcounter.set("url",url);</span></span><br><span class="line"><span class="regexp">                    newcounter.set("time",1);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    $('.post-meta').append(" | PV: 1");</span></span><br><span class="line"><span class="regexp">                    newcounter.save().then(function (counter) &#123;</span></span><br><span class="line"><span class="regexp">                        /</span><span class="regexp">/ 成功</span></span><br><span class="line"><span class="regexp">                    &#125;,function (error) &#123;</span></span><br><span class="line"><span class="regexp">                        /</span><span class="regexp">/ 失败</span></span><br><span class="line"><span class="regexp">                    &#125;);</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            error: function(error)&#123;</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &#125;);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<p>这里 JS 文件的链接与原文的不同，原文提供的链接已经失效，这点原作者有提醒，另外初始化方法也不一样，这是升级所致，具体可见：<a href="https://leancloud.cn/docs/sdk_setup-js.html#初始化" target="_blank" rel="noopener"><a href="https://leancloud.cn/docs/sdk_setup-js.html#JavaScript_SDK_安装指南" target="_blank" rel="noopener">JavaScript SDK 安装指南</a></a>，下面是一个简单的存取，方法可见文档：[<a href="https://leancloud.cn/docs/leanstorage_guide-js.html#数据存储开发指南___JavaScript" target="_blank" rel="noopener">数据存储开发指南 · JavaScript</a>]</p>
<p>另外还有一个需要注意的点就是在 LeanCloud 上新建 Class 的时候，权限务必选择无限制，不然在更新数据的时候会被 Forbidden。</p>
<h2 id="博客统计功能"><a href="#博客统计功能" class="headerlink" title="博客统计功能"></a>博客统计功能</h2><p>这个功能使用的是插件<a href="https://www.npmjs.com/package/hexo-wordcount" target="_blank" rel="noopener">hexo-wordcount</a>，提供以下三个功能：</p>
<ol>
<li>博客总数量统计；</li>
<li>博客字数统计；</li>
<li>预计阅读时间统计；</li>
</ol>
<p>具体怎么用在官网上有明确的说明，而具体放置在什么位置，读者可以研究一下主题下面<code>/layout/_partial/article.ejs</code>文件，这个文件描述了在文章列表和详情页面文章如何显示，找一个合适的地方插入即可。</p>
<blockquote>
<p>注：可以通过 index 这个参数判断是不是在列表页面上。</p>
</blockquote>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>粗略感觉 Hexo 是一个结构非常好的项目，即使我这种菜鸟也能在短时间内照葫芦画瓢进行一些个性化定制，配置 Hexo 的过程极大的激发了我学前端的欲望。</p>
</div><div class="tags"><a href="/tags/Hexo/">Hexo</a></div><div class="post-nav"><a href="/2016/12/08/Android卡顿监控方案以及局限性/" class="pre">Android卡顿监控方案以及局限性</a><a href="/2016/11/30/log4j/" class="next">Log4j</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">59</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactiveX/">ReactiveX</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/影视/">影视</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/电影/">电影</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Gitbook/" style="font-size: 15px;">Gitbook</a> <a href="/tags/Runtime/" style="font-size: 15px;">Runtime</a> <a href="/tags/视图/" style="font-size: 15px;">视图</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/权限/" style="font-size: 15px;">权限</a> <a href="/tags/代码优化/" style="font-size: 15px;">代码优化</a> <a href="/tags/Framework/" style="font-size: 15px;">Framework</a> <a href="/tags/性能优化/" style="font-size: 15px;">性能优化</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/合集/" style="font-size: 15px;">合集</a> <a href="/tags/ADB/" style="font-size: 15px;">ADB</a> <a href="/tags/源码/" style="font-size: 15px;">源码</a> <a href="/tags/反编译/" style="font-size: 15px;">反编译</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/基础/" style="font-size: 15px;">基础</a> <a href="/tags/效率/" style="font-size: 15px;">效率</a> <a href="/tags/MarkDown/" style="font-size: 15px;">MarkDown</a> <a href="/tags/电影/" style="font-size: 15px;">电影</a> <a href="/tags/Reactive/" style="font-size: 15px;">Reactive</a> <a href="/tags/AIDL/" style="font-size: 15px;">AIDL</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/驱动/" style="font-size: 15px;">驱动</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/日志/" style="font-size: 15px;">日志</a> <a href="/tags/事件/" style="font-size: 15px;">事件</a> <a href="/tags/代码设计/" style="font-size: 15px;">代码设计</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/测试/" style="font-size: 15px;">测试</a> <a href="/tags/Binder/" style="font-size: 15px;">Binder</a> <a href="/tags/Groovy/" style="font-size: 15px;">Groovy</a> <a href="/tags/Loader/" style="font-size: 15px;">Loader</a> <a href="/tags/RAC/" style="font-size: 15px;">RAC</a> <a href="/tags/事件处理/" style="font-size: 15px;">事件处理</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/AIDL-原理分析/">AIDL 原理分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/App-启动过程/">App 启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/PMS-解析/">PMS 解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/WMS-解析/">WindowManagerService 解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/AMS-解析/">AMS 解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/The-Good-Wife/">The-Good-Wife</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/Black-Sails/">黑帆</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/29/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/23/XCode-8-2-1-ClangFormat-插件安装/">XCode 8.2.1 ClangFormat 插件安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/07/SourceTree-分支图谱/">SourceTree 分支图谱</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">蜗牛壳.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>